# Оновлення та обслуговування системи (v1.1.5)

OpenTrace v1.1.5 продовжує розвиток архітектури автоматичних оновлень, забезпечуючи плавний перехід між стабільними версіями зі спеціалізованою логікою міграції метаданих ClickHouse та PostgreSQL.

## 1. Як це працює

Процес оновлення складається з кількох рівнів:

1.  **Реєстр версій**: Система перевіряє `https://version.429toomanyre.quest/version.json` на наявність останньої версії саме для проекту `opentrace`.
2.  **Файл-тригер**: Коли ви натискаєте "Встановити оновлення", бекенд створює файл-тригер у `/app/data/updates/trigger`.
3.  **Update Watcher**: Легкий скрипт (`updater.sh`), що працює на хост-машині, моніторить цю директорію.
4.  **Автоматична збірка**: Коли тригер виявлено:
    -   Система виконує `git pull` для завантаження останнього коду.
    -   Docker Compose перезбирає контейнери (`up --build -d`).
    -   Оточення системи оновлюється.

## 2. Налаштування Update Watcher

Якщо ви встановлювали OpenTrace за допомогою `install.sh` або використовували останній `restore_all.py`, воркер оновлень вже має працювати.

Для ручного запуску воркера:
```bash
./updater.sh & 
```
*Примітка: Переконайтеся, що скрипт має права на виконання (`chmod +x updater.sh`).*

## 3. Рекомендації

-   **Резервні копії**: Перед оновленням наполегливо рекомендуємо зробити копію директорії `data/`. Хоча Docker volumes зберігають ваші дані під час перезбірки, бекап — це гарантія безпеки.
-   **Перерва в роботі**: Оновлення зазвичай триває 2-5 хвилин. У цей час дашборд та API трекінгу будуть недоступні.
-   **SMTP**: Переконайтеся, що налаштування SMTP вказані в **Налаштування -> Налаштування SMTP**. Це критично для відновлення доступу, якщо ваша сесія завершиться під час оновлення.

## 4. Ручне оновлення

Якщо автоматичне оновлення не спрацювало або ви віддаєте перевагу ручному контролю:
```bash
git pull origin main
docker compose -f docker-compose.prod.yml up --build -d
```
